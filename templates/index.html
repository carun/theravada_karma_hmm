<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theravada Karma HMM - Interactive Simulation</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                Theravada Karma HMM
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-clock me-1"></i>
                    <span id="current-time">Not initialized</span>
                </span>
                <button class="btn btn-outline-light btn-sm" id="reset-btn">
                    <i class="fas fa-undo me-1"></i>Reset
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-3">
        <div class="row">
            <!-- Left Panel - Controls -->
            <div class="col-lg-3">
                <!-- Connection Status -->
                <div class="card mb-3">
                    <div class="card-header bg-info text-white">
                        <i class="fas fa-wifi me-2"></i>Connection Status
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div id="connection-status" class="status-indicator disconnected me-2"></div>
                            <span id="connection-text">Connecting...</span>
                        </div>
                    </div>
                </div>

                <!-- Simulation Configuration -->
                <div class="card mb-3">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-cogs me-2"></i>Simulation Config
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="time-unit" class="form-label">Time Unit</label>
                            <select class="form-select" id="time-unit">
                                <option value="days">Days</option>
                                <option value="months" selected>Months</option>
                                <option value="years">Years</option>
                                <option value="lifetimes">Lifetimes</option>
                                <option value="rebirths">Rebirths</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="time-scale" class="form-label">Time Scale Factor</label>
                            <input type="number" class="form-control" id="time-scale" value="1.0" min="0.1" max="10"
                                step="0.1">
                        </div>
                        <div class="mb-3">
                            <label for="simulation-speed" class="form-label">Simulation Speed</label>
                            <input type="range" class="form-range" id="simulation-speed" min="100" max="5000" step="100"
                                value="1000">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">Fast (0.1s)</small>
                                <small class="text-muted">Slow (5s)</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="auto-action-rate" class="form-label">Auto Action Rate</label>
                            <input type="range" class="form-range" id="auto-action-rate" min="0" max="1" step="0.1"
                                value="0.3">
                            <small class="text-muted">0.3</small>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="init-simulation-btn">
                                <i class="fas fa-cog me-2"></i>Initialize Simulation
                            </button>
                            <button class="btn btn-success" id="toggle-simulation-btn" style="display: none;">
                                <i class="fas fa-play me-2"></i>Start Continuous Simulation
                            </button>
                        </div>
                        <div id="simulation-stats" class="mt-2 text-center"></div>
                    </div>
                </div>

                <!-- Meditation Practices -->
                <div class="card mb-3">
                    <div class="card-header bg-success text-white">
                        <i class="fas fa-leaf me-2"></i>Meditation Practices
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="meditation-type" class="form-label">Practice Type</label>
                            <select class="form-select" id="meditation-type">
                                <option value="VIPASSANA">Vipassana</option>
                                <option value="METTA">Metta</option>
                                <option value="SAMATHA">Samatha</option>
                                <option value="WALKING">Walking Meditation</option>
                            </select>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <label for="daily-duration" class="form-label">Daily Duration (hrs)</label>
                                <input type="number" class="form-control" id="daily-duration" value="1.0" min="0.1"
                                    max="12" step="0.1">
                            </div>
                            <div class="col-6">
                                <label for="consistency" class="form-label">Consistency</label>
                                <input type="range" class="form-range" id="consistency" min="0" max="1" step="0.1"
                                    value="0.8">
                                <small class="text-muted">0.8</small>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <label for="quality" class="form-label">Quality</label>
                                <input type="range" class="form-range" id="quality" min="0" max="1" step="0.1"
                                    value="0.7">
                                <small class="text-muted">0.7</small>
                            </div>
                            <div class="col-6">
                                <label for="years-practiced" class="form-label">Years</label>
                                <input type="number" class="form-control" id="years-practiced" value="1" min="0"
                                    max="50" step="0.5">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <label for="teacher-guidance" class="form-label">Teacher Guidance</label>
                                <input type="range" class="form-range" id="teacher-guidance" min="0" max="1" step="0.1"
                                    value="0.5">
                                <small class="text-muted">0.5</small>
                            </div>
                            <div class="col-6">
                                <label for="retreat-hours" class="form-label">Retreat Hours</label>
                                <input type="number" class="form-control" id="retreat-hours" value="0" min="0"
                                    max="1000" step="10">
                            </div>
                        </div>
                        <button class="btn btn-success w-100" id="add-meditation-btn" disabled>
                            <i class="fas fa-plus me-2"></i>Add Practice
                        </button>
                    </div>
                </div>

                <!-- Action Generator -->
                <div class="card mb-3">
                    <div class="card-header bg-warning text-dark">
                        <i class="fas fa-bolt me-2"></i>Action Generator
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="wholesome-action">
                                <label class="form-check-label" for="wholesome-action">
                                    Wholesome Action
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="intention-strength" class="form-label">Intention Strength</label>
                            <input type="range" class="form-range" id="intention-strength" min="0" max="1" step="0.1"
                                value="0.7">
                            <small class="text-muted">0.7</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Active Kilesas</label>
                            <div id="kilesa-checkboxes" class="kilesa-grid">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                        <button class="btn btn-warning w-100" id="perform-action-btn" disabled>
                            <i class="fas fa-play me-2"></i>Perform Action
                        </button>
                    </div>
                </div>

                <!-- Time Control -->
                <div class="card mb-3">
                    <div class="card-header bg-info text-white">
                        <i class="fas fa-clock me-2"></i>Time Control
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="time-steps" class="form-label">Time Steps</label>
                            <input type="number" class="form-control" id="time-steps" value="1" min="1" max="100">
                        </div>
                        <div class="mb-3">
                            <label for="stress-level" class="form-label">Stress Level</label>
                            <input type="range" class="form-range" id="stress-level" min="0" max="1" step="0.1"
                                value="0.5">
                            <small class="text-muted">0.5</small>
                        </div>
                        <button class="btn btn-info w-100" id="advance-time-btn" disabled>
                            <i class="fas fa-step-forward me-2"></i>Advance Time
                        </button>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Visualizations -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-dark text-white">
                        <ul class="nav nav-pills card-header-pills" id="viz-tabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="evolution-tab" data-bs-toggle="pill"
                                    data-bs-target="#evolution-panel" type="button" role="tab">
                                    <i class="fas fa-chart-line me-1"></i>Evolution
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="network-tab" data-bs-toggle="pill"
                                    data-bs-target="#network-panel" type="button" role="tab">
                                    <i class="fas fa-project-diagram me-1"></i>Network
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="patterns-tab" data-bs-toggle="pill"
                                    data-bs-target="#patterns-panel" type="button" role="tab">
                                    <i class="fas fa-th me-1"></i>Patterns
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body p-1">
                        <div class="tab-content" id="viz-content">
                            <div class="tab-pane fade show active" id="evolution-panel" role="tabpanel">
                                <div id="evolution-chart" style="height: 600px;"></div>
                            </div>
                            <div class="tab-pane fade" id="network-panel" role="tabpanel">
                                <div id="network-chart" style="height: 600px;"></div>
                            </div>
                            <div class="tab-pane fade" id="patterns-panel" role="tabpanel">
                                <div id="patterns-chart" style="height: 600px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - State & Analysis -->
            <div class="col-lg-3">
                <!-- Current State -->
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-info-circle me-2"></i>Current State
                    </div>
                    <div class="card-body">
                        <div class="state-info">
                            <div class="mb-2">
                                <strong>Path Stage:</strong>
                                <span id="path-stage" class="badge bg-secondary ms-2">Not Started</span>
                            </div>
                            <div class="mb-2">
                                <strong>Karmic Balance:</strong>
                                <span id="karmic-balance" class="ms-2">0.00</span>
                            </div>
                            <div class="mb-2">
                                <strong>Active Seeds:</strong>
                                <span id="active-seeds" class="badge bg-info ms-2">0</span>
                            </div>
                            <div class="mb-2">
                                <strong>Practices:</strong>
                                <span id="practice-count" class="badge bg-success ms-2">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Log -->
                <div class="card mb-3">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-list me-2"></i>Activity Log
                    </div>
                    <div class="card-body p-0">
                        <div id="activity-log" class="activity-log-container">
                            <div class="p-3 text-muted text-center">
                                No activities yet
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card mb-3">
                    <div class="card-header bg-danger text-white">
                        <i class="fas fa-zap me-2"></i>Quick Actions
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-danger btn-sm" onclick="quickAction('anger')">
                                <i class="fas fa-fire me-1"></i>Anger Moment
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="quickAction('greed')">
                                <i class="fas fa-hand-holding me-1"></i>Greedy Action
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="quickAction('compassion')">
                                <i class="fas fa-heart me-1"></i>Compassionate Act
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="quickAction('meditation')">
                                <i class="fas fa-leaf me-1"></i>Meditation Session
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/controls.js"></script>
    <script src="/static/js/charts.js"></script>
</body>

</html>
